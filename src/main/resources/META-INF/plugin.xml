<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <idea-version since-build="251" />
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>paol0b.AzureDevOps</id>
    <version>2.1</version>

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html#plugin-name -->
    <name>Azure DevOps Integration</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor url="https://github.com/paol0b">Paolo Bertinetti</vendor>

    <!-- Description of the plugin displayed on the Plugin Page and IDE Plugin Manager.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html#plugin-description -->
    <description><![CDATA[
        <h2>Azure DevOps Integration for JetBrains IDEs</h2>
        <p>Manage Azure DevOps Pull Requests directly from your IDE - clone repositories, view PRs, browse code changes, read comments, and handle reviews without switching to the browser.</p>

        <h3>‚ú® Core Features:</h3>

        <h4>üì¶ Clone Repositories from Azure DevOps</h4>
        <ul>
            <li><b>Browse by Organization:</b> See all your Azure DevOps organizations</li>
            <li><b>Project & Repository Listing:</b> Easy navigation through projects and repos</li>
            <li><b>One-Click Clone:</b> Clone directly into your IDE with automatic setup</li>
            <li><b>Multiple Accounts:</b> Switch between different Azure DevOps accounts</li>
        </ul>

        <h4>üìã Pull Request Management Tool</h4>
        <ul>
            <li><b>View All PRs:</b> Browse PRs filtered by status (Active, Completed, Abandoned, All)</li>
            <li><b>PR Details:</b> See title, description, author, reviewers, and source/target branches</li>
            <li><b>Create PRs:</b> New PR dialog with branch autocomplete and reviewer selection</li>
            <li><b>Quick Actions:</b> Approve, Complete, or Abandon PRs directly from the IDE</li>
            <li><b>Open in Browser:</b> Jump to the PR in Azure DevOps for advanced options</li>
            <li><b>File Changes:</b> View which files were modified in each PR</li>
            <li><b>Commit History:</b> See all commits included in the PR</li>
        </ul>

        <h4>üí¨ Comment Browser Tool</h4>
        <ul>
            <li><b>Find Comments:</b> See all PR comments with one-click navigation to the code</li>
            <li><b>Filter By Status:</b> Show all, active, resolved, or general comments</li>
            <li><b>Search Comments:</b> Filter by file, author, or content</li>
            <li><b>Jump to Code:</b> Click any comment to go directly to that line in the editor</li>
            <li><b>View Threads:</b> Read full comment conversations and discussions</li>
            <li><b>Comment Counts:</b> See badges on files showing how many comments they have</li>
        </ul>

        <h4>üîê Authentication & Security</h4>
        <ul>
            <li><b>OAuth 2.0:</b> Sign in with your Microsoft account (no token copy/paste needed)</li>
            <li><b>Multiple Accounts:</b> Add and switch between different organizations</li>
            <li><b>Auto-Detection:</b> Plugin automatically finds the right account for your repository</li>
            <li><b>Secure Storage:</b> Credentials safely stored in IDE's password manager</li>
            <li><b>Token Refresh:</b> Tokens update automatically - no manual renewal</li>
        </ul>

        <h3>üìã Requirements:</h3>
        <ul>
            <li>IntelliJ IDEA 2025.1 or newer (supports all JetBrains IDEs)</li>
            <li>Git repository cloned from Azure DevOps</li>
            <li>Microsoft account with access to your Azure DevOps organization</li>
        </ul>

        <h3>üöÄ Getting Started:</h3>
        <ol>
            <li><b>Install & Restart:</b> Install plugin and restart your IDE</li>
            <li><b>Add Account:</b> Go to Settings ‚Üí Tools ‚Üí Azure DevOps Accounts ‚Üí Add</li>
            <li><b>Sign In:</b> Click "Sign in with Browser" and authenticate with Microsoft</li>
            <li><b>Open PR Tool:</b> Look for "Azure DevOps PRs" in the right-side tool windows</li>
            <li><b>Start Managing:</b> View PRs, create new ones, browse comments, and merge code</li>
        </ol>

        <h3>üìö Documentation:</h3>
        <ul>
            <li><a href="https://github.com/paol0b/AzureDevOps/blob/main/GETTING_STARTED.md">Getting Started Guide</a> - Complete setup and feature tour</li>
            <li><a href="https://github.com/paol0b/AzureDevOps/blob/main/docs/OAUTH_SETUP.md">Authentication Setup</a> - Configure OAuth 2.0 login</li>
            <li><a href="https://github.com/paol0b/AzureDevOps/blob/main/docs/USAGE_EXAMPLES.md">Common Workflows</a> - Step-by-step examples for creating PRs and reviewing code</li>
        </ul>

        <h3>üÜò Support & Bug Reports:</h3>
        <p><b>Found a bug or need help?</b> Please <a href="https://github.com/paol0b/AzureDevOps/issues">open an issue on GitHub</a> instead of leaving a bad review!</p>
        <ul>
            <li><b>Report bugs:</b> Help us fix issues faster by reporting them with details</li>
            <li><b>Request features:</b> Share your ideas to help the plugin grow</li>
            <li><b>Get support:</b> Ask questions and get help from the community</li>
        </ul>
        <p>Issues are much more helpful than negative reviews. With your feedback, we can make this plugin better for everyone! üí™</p>
    ]]></description>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.vcs</depends>
    <depends>Git4Idea</depends>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Azure DevOps Checkout Provider for Clone Repository dialog -->
        <checkoutProvider implementation="paol0b.azuredevops.checkout.AzureDevOpsCheckoutProvider"/>
        <!-- Application-level service for account management -->
        <applicationService serviceImplementation="paol0b.azuredevops.checkout.AzureDevOpsAccountManager"/>
        <!-- OAuth authentication service -->
        <applicationService serviceImplementation="paol0b.azuredevops.checkout.AzureDevOpsOAuthService"/>
        
        <!-- Application-level configuration for accounts -->
        <applicationConfigurable 
            parentId="tools" 
            instance="paol0b.azuredevops.ui.AzureDevOpsAccountsConfigurable"
            id="paol0b.azuredevops.accounts"
            displayName="Azure DevOps Accounts"/>
            
        <!-- Project-level configuration -->
        <!--
        <projectConfigurable
            parentId="tools"
            instance="paol0b.azuredevops.ui.AzureDevOpsProjectConfigurable"
            id="paol0b.azuredevops.project"
            displayName="Azure DevOps"/>
        -->

        <!-- Notification Group -->
        <notificationGroup
                id="AzureDevOps.Notifications"
                displayType="BALLOON"
                key="notification.group.azure.devops"/>

        <!-- Tool Window -->
        <toolWindow
                id="Azure DevOps PRs"
                anchor="right"
                icon="paol0b.azuredevops.AzureDevOpsIcons.ToolWindow"
                factoryClass="paol0b.azuredevops.toolwindow.PullRequestToolWindowFactory"
                canCloseContents="false"
                doNotActivateOnStart="false"/>

        <!-- Comments Navigator Tool Window -->
        <toolWindow
                id="PR Comments"
                anchor="right"
                icon="AllIcons.Toolwindows.ToolWindowMessages"
                factoryClass="paol0b.azuredevops.toolwindow.CommentsNavigatorToolWindow"/>

        <!-- PR Review Tool Window (Master-Detail Diff Viewer) -->
        <toolWindow
                id="PR Review"
                anchor="right"
                icon="AllIcons.Actions.Diff"
                factoryClass="paol0b.azuredevops.toolwindow.review.PrReviewToolWindowFactory"
                canCloseContents="false"
                doNotActivateOnStart="false"/>

        <!-- File Decorator for PR Comments -->
        <projectViewNodeDecorator implementation="paol0b.azuredevops.decorators.FileWithCommentsDecorator"/>

        <!-- File Editor Listener for PR detection -->
        <projectService serviceImplementation="paol0b.azuredevops.listeners.FileOpenedListener"/>
    </extensions>

    <projectListeners>
        <listener
                class="paol0b.azuredevops.listeners.FileOpenedListener"
                topic="com.intellij.openapi.fileEditor.FileEditorManagerListener"/>
        <listener
                class="paol0b.azuredevops.listeners.GitRepositoryChangeListener"
                topic="com.intellij.openapi.vcs.BranchChangeListener"/>
    </projectListeners>

    <actions>
        <!-- Azure DevOps Group in Git Menu -->
        <group id="AzureDevOps.Group"
               text="Azure DevOps"
               icon="paol0b.azuredevops.AzureDevOpsIcons.ToolWindow"
               popup="true">
            <!-- Place this group immediately after the GitHub menu entry -->
            <add-to-group group-id="VcsGroups" anchor="after" relative-to-action="GitHub"/>

            <action
                    id="AzureDevOps.CreatePullRequest"
                    class="paol0b.azuredevops.actions.CreatePullRequestAction"
                    text="Create Pull Request..."
                    description="Create a Pull Request on Azure DevOps"
                    icon="paol0b.azuredevops.AzureDevOpsIcons.ToolWindow"/>

            <action
                    id="AzureDevOps.OpenInBrowser"
                    class="paol0b.azuredevops.actions.OpenRepositoryInBrowserAction"
                    text="Open in Browser"
                    description="Open the repository in Azure DevOps web portal"
                    icon="AllIcons.Ide.External_link_arrow"/>
        </group>

        <!-- Add to VCS menu (legacy) -->
        <action
                id="AzureDevOps.CreatePullRequest.Legacy"
                class="paol0b.azuredevops.actions.CreatePullRequestAction"
                text="Create Azure DevOps PR"
                description="Create a Pull Request on Azure DevOps"
                icon="paol0b.azuredevops.AzureDevOpsIcons.ToolWindow">
            <add-to-group group-id="Vcs.MainMenu" anchor="last"/>
        </action>

        <!-- Show PR Comments in Editor (legacy action) -->
        <action
                id="AzureDevOps.ShowPRComments"
                class="paol0b.azuredevops.actions.ShowPullRequestCommentsAction"
                text="Show PR Comments"
                description="Show Pull Request comments in the current file"
                icon="AllIcons.Vcs.CommitNode">
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
            <add-to-group group-id="Vcs.MainMenu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>