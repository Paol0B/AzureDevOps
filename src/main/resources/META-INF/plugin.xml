<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>paol0b.AzureDevOps</id>

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html#plugin-name -->
    <name>Azure DevOps Integration</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor url="https://github.com/paol0b">Paolo Bertinetti</vendor>

    <!-- Description of the plugin displayed on the Plugin Page and IDE Plugin Manager.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html#plugin-description -->
    <description><![CDATA[
        <h2>Azure DevOps Integration for JetBrains IDEs</h2>
        <p>Integrate Azure DevOps directly into your JetBrains IDE with a dedicated Tool Window for managing Pull Requests, inspired by Visual Studio.</p>

        <h3>âœ¨ Key Features:</h3>
        <ul>
            <li><b>ğŸªŸ "Azure DevOps PRs" Tool Window:</b> Sidebar window to view and manage all pull requests</li>
            <li><b>ğŸ“‹ Organized PR List:</b> See all PRs grouped by status (Active, Completed, Abandoned)</li>
            <li><b>ğŸ” Full Details:</b> Panel with title, description, branch, author, reviewers, and status</li>
            <li><b>ğŸ¨ Status Badges:</b> Instantly identify PR status with color-coded badges</li>
            <li><b>ğŸ” Filters:</b> Show only active PRs or all PRs with one click</li>
            <li><b>ï¿½ Automatic Detection:</b> The plugin auto-detects Azure DevOps repositories by analyzing the Git remote URL</li>
            <li><b>âš¡ Easy Setup:</b> Only the Personal Access Token is required; Organization, Project, and Repository are auto-detected</li>
            <li><b>ğŸ“ Create Pull Requests:</b> Create PRs to main/master directly from the IDE or Tool Window</li>
            <li><b>ğŸŒ¿ Branch Selection:</b> Choose source and target branches with autocomplete</li>
            <li><b>ğŸ”’ Secure Storage:</b> PAT is securely saved using the IDE's password storage system</li>
            <li><b>ğŸ”” Notifications:</b> Get instant feedback on success or errors</li>
            <li><b>ğŸ”— Quick Links:</b> Open PRs in your browser with one click</li>
            <li><b>ğŸ‘ï¸ Smart Visibility:</b> Tool window and actions appear only for Azure DevOps repositories</li>
            <li><b>â˜‘ï¸ File Selection for Diff:</b> Select which files to include in PR review diffs using checkboxes</li>
            <li><b>ğŸ’¬ Enhanced Comments:</b> View, add, and manage PR comments with auto-refresh and feedback</li>
        </ul>

        <h3>ğŸ“‹ Requirements:</h3>
        <ul>
            <li>Repository cloned from Azure DevOps (HTTPS or SSH URL)</li>
            <li>Personal Access Token with Code and Pull Request permissions</li>
        </ul>

        <h3>ğŸš€ How to Use:</h3>
        <ol>
            <li>Clone a repository from Azure DevOps</li>
            <li>Go to <b>Settings â†’ Tools â†’ Azure DevOps</b></li>
            <li>Enter only your <b>Personal Access Token</b> (Organization/Project/Repository are auto-detected)</li>
            <li>Open the <b>"Azure DevOps PRs" Tool Window</b> in the sidebar</li>
            <li>View, create, and manage your Pull Requests!</li>
        </ol>

        <h3>ğŸŒ Supported URLs:</h3>
        <ul>
            <li>HTTPS: <code>https://dev.azure.com/{org}/{project}/_git/{repo}</code></li>
            <li>SSH: <code>git@ssh.dev.azure.com:v3/{org}/{project}/{repo}</code></li>
            <li>Legacy: <code>https://{org}.visualstudio.com/{project}/_git/{repo}</code></li>
        </ul>

        <p><em>Works only with Azure DevOps repositories. The plugin automatically detects the Git remote URL and shows features only when applicable.</em></p>
    ]]></description>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.vcs</depends>
    <depends>Git4Idea</depends>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Project Settings -->
        <projectConfigurable 
            parentId="tools" 
            instance="paol0b.azuredevops.ui.AzureDevOpsConfigurable"
            id="paol0b.azuredevops.settings"
            displayName="Azure DevOps"
            nonDefaultProject="true"/>
        
        <!-- Notification Group -->
        <notificationGroup 
            id="AzureDevOps.Notifications" 
            displayType="BALLOON"
            key="notification.group.azure.devops"/>
        
        <!-- Tool Window -->
        <toolWindow
            id="Azure DevOps PRs"
            anchor="right"
            icon="paol0b.azuredevops.AzureDevOpsIcons.ToolWindow"
            factoryClass="paol0b.azuredevops.toolwindow.PullRequestToolWindowFactory"
            canCloseContents="false"
            doNotActivateOnStart="false"/>
        
        <!-- Comments Navigator Tool Window -->
        <toolWindow
            id="PR Comments"
            anchor="right"
            icon="AllIcons.Toolwindows.ToolWindowMessages"
            factoryClass="paol0b.azuredevops.toolwindow.CommentsNavigatorToolWindow"/>
        
        <!-- File Decorator for PR Comments -->
        <projectViewNodeDecorator implementation="paol0b.azuredevops.decorators.FileWithCommentsDecorator"/>
        
        <!-- File Editor Listener for PR detection -->
        <projectService serviceImplementation="paol0b.azuredevops.listeners.FileOpenedListener"/>
    </extensions>
    
    <projectListeners>
        <listener 
            class="paol0b.azuredevops.listeners.FileOpenedListener"
            topic="com.intellij.openapi.fileEditor.FileEditorManagerListener"/>
        <listener
            class="paol0b.azuredevops.listeners.GitRepositoryChangeListener"
            topic="com.intellij.openapi.vcs.BranchChangeListener"/>
    </projectListeners>

    <actions>
        <!-- Add to VCS menu -->
        <action 
            id="AzureDevOps.CreatePullRequest"
            class="paol0b.azuredevops.actions.CreatePullRequestAction"
            text="Create Azure DevOps PR"
            description="Create a Pull Request on Azure DevOps"
            icon="AllIcons.Vcs.Vendors.Github">
            <add-to-group group-id="VcsGroups" anchor="last"/>
            <add-to-group group-id="Vcs.MainMenu" anchor="last"/>
        </action>
        
        <!-- Toggle PR Comments - Quick Access -->
        <action
            id="AzureDevOps.TogglePRComments"
            class="paol0b.azuredevops.actions.TogglePRCommentsAction"
            text="Show/Hide PR Comments"
            description="Toggle Pull Request comments visibility in the editor"
            icon="AllIcons.Toolwindows.ToolWindowMessages">
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
            <add-to-group group-id="Vcs.MainMenu" anchor="last"/>
            <add-to-group group-id="MainToolBar" anchor="last"/>
        </action>
        
        <!-- Show PR Comments in Editor (legacy action) -->
        <action
            id="AzureDevOps.ShowPRComments"
            class="paol0b.azuredevops.actions.ShowPullRequestCommentsAction"
            text="Show PR Comments"
            description="Show Pull Request comments in the current file"
            icon="AllIcons.Vcs.CommitNode">
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
            <add-to-group group-id="Vcs.MainMenu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>